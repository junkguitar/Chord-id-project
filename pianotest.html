<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Tone.js Piano Test</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
</head>
<body style="background:#111;color:#eee;font-family:sans-serif;padding:20px;">
  <h2>Piano Sound Test (Tone.js)</h2>
  <p>1) Click <b>Start Audio</b> once.<br>
     2) Then click <b>Play Cmaj7</b> to hear the piano.</p>

  <button id="startBtn">Start Audio</button>
  <button id="playBtn" disabled>Play Cmaj7</button>

  <pre id="log" style="margin-top:20px;font-size:12px;background:#222;padding:10px;max-width:600px;white-space:pre-wrap;"></pre>

  <!-- Tone.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.min.js"></script>

  <!-- Piano Soundfont (bright grand) -->
  <script src="https://cdn.jsdelivr.net/npm/@magenta/music@1.23.1/es6/soundfont.js"></script>

  <script>
    let piano = null;

    const startBtn = document.getElementById('startBtn');
    const playBtn  = document.getElementById('playBtn');
    const logEl    = document.getElementById('log');

    function log(msg) {
      console.log('[TEST]', msg);
      logEl.textContent += msg + '\\n';
    }

    startBtn.onclick = async () => {
      try {
        await Tone.start();
        log('Tone.js audio started.');

        log('Loading piano...');
        piano = await SoundFont.loadInstrument('acoustic_grand_piano');
        log('Piano ready.');

        playBtn.disabled = false;
      } catch (err) {
        log('ERROR: ' + err.message);
      }
    };

    playBtn.onclick = async () => {
      if (!piano) { log('Piano not ready'); return; }

      log('Playing Cmaj7...');
      const notes = ['C4', 'E4', 'G4', 'B4'];

      notes.forEach(n => {
        piano.play(n, Tone.now(), { duration: 3.0, gain: 0.8 });
      });
    };
  </script>
</body>
</html>
